<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Gabungkan Gambar dan Prompt</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0; padding: 20px;
}
h1 { text-align: center; }
.container { max-width: 700px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
label { display: block; margin-top: 10px; font-weight: bold; }
input[type="text"], input[type="file"] { width: 100%; padding: 10px; margin-top: 5px; }
button { margin-top: 10px; width: 100%; padding: 12px; background: #4CAF50; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background: #45a049; }
#result { margin-top: 20px; text-align: center; }
#canvas { display: none; }
</style>
</head>
<body>

<h1>Gabungkan Gambar dan Prompt</h1>
<div class="container">

  <label for="imageUpload">Upload Gambar:</label>
  <input type="file" id="imageUpload" accept="image/*" />

  <label for="promptInput">Masukkan Prompt:</label>
  <input type="text" id="promptInput" placeholder="Masukkan prompt" />

  <button onclick="prepareImage()">Gabungkan dan Generate</button>

  <div id="result"></div>

  <!-- Canvas untuk gabungkan gambar dan teks -->
  <canvas id="canvas"></canvas>

</div>

<script>
let uploadedImage = new Image();

function prepareImage() {
  const fileInput = document.getElementById('imageUpload');
  const file = fileInput.files[0];
  const prompt = document.getElementById('promptInput').value.trim();

  if (!file) {
    alert('Pilih gambar dulu!');
    return;
  }
  if (!prompt) {
    alert('Masukkan prompt!');
    return;
  }

  // Baca gambar file
  const reader = new FileReader();
  reader.onload = function(e) {
    uploadedImage.src = e.target.result;
    uploadedImage.onload = function() {
      // Setelah gambar siap, gabungkan
      drawImageWithText();
    }
  }
  reader.readAsDataURL(file);
}

function drawImageWithText() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // ukuran canvas sama dengan gambar
  canvas.width = uploadedImage.width;
  canvas.height = uploadedImage.height + 50; // tambah space buat teks

  // gambar di canvas
  ctx.drawImage(uploadedImage, 0, 0);

  // overlay teks prompt di bawah gambar
  ctx.fillStyle = 'white';
  ctx.fillRect(0, uploadedImage.height, uploadedImage.width, 50);

  ctx.font = '20px Arial';
  ctx.fillStyle = 'black';
  ctx.textAlign = 'center';
  ctx.fillText(document.getElementById('promptInput').value.trim(), uploadedImage.width/2, uploadedImage.height + 30);

  // tampilkan gambar gabungan
  const dataURL = canvas.toDataURL();

  // tampilkan di result
  document.getElementById('result').innerHTML = `<img src="${dataURL}" />`;

  // panggil API generate dengan gambar gabungan
  generateFromImage(dataURL);
}

// fungsi generate dari API
function generateFromImage(imageData) {
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML += '<p class="loading">Memproses, harap tunggu...</p>';

  // Contoh API
  const apiUrl = `https://api.ibeng.my.id/api/ai/veo3?query=${encodeURIComponent(imageData)}&apikey=MELvQtx7BG`;

  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      resultDiv.innerHTML = '';

      // tampilkan gambar gabungan dulu
      const img = document.createElement('img');
      img.src = imageData;
      resultDiv.appendChild(img);

      // tampilkan hasil API
      if (data && data.data && data.data.data) {
        const media = data.data.data;
        if (media.image_url) {
          const img2 = document.createElement('img');
          img2.src = media.image_url;
          resultDiv.appendChild(img2);
        }
        if (media.video_url) {
          const vid = document.createElement('video');
          vid.src = media.video_url;
          vid.controls = true;
          resultDiv.appendChild(vid);
        }
      }
    })
    .catch(err => {
      resultDiv.innerHTML = 'Gagal generate: ' + err.message;
    });
}
</script>

</body>
</html>
