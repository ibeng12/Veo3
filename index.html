<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Gabungan Gambar Upload dan Prompt</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  margin: 0; padding: 20px;
}
h1 {
  text-align: center; color: #333;
}
.container {
  max-width: 600px; margin: 0 auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
label {
  display: block; margin-top: 10px; margin-bottom: 5px; font-weight: bold;
}
input[type="text"], input[type="file"] {
  width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
}
button {
  width: 100%; padding: 12px; margin-top: 10px; background: #4CAF50; color: #fff; border: none; border-radius: 4px; cursor: pointer;
}
button:hover {
  background: #45a049;
}
#result {
  margin-top: 20px; text-align: center;
}
#result img {
  max-width: 100%; height: auto; margin-bottom: 10px; border-radius: 8px;
}
#result video {
  max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px;
}
</style>
</head>
<body>

<h1>Upload Gambar & Input Prompt</h1>
<div class="container">

  <label for="imageUpload">Upload Gambar Baru:</label>
  <input type="file" id="imageUpload" accept="image/*" />

  <button onclick="uploadGambar()">Upload Gambar</button>
  <div id="uploadStatus"></div>

  <label for="prompt">Masukkan Prompt:</label>
  <input type="text" id="prompt" placeholder="Isi prompt" />

  <button onclick="generate()">Generate</button>

  <div id="result"></div>

</div>

<script>
let uploadedImageUrl = ''; // Variabel global untuk simpan URL gambar

function uploadGambar() {
  const fileInput = document.getElementById('imageUpload');
  const statusDiv = document.getElementById('uploadStatus');
  const file = fileInput.files[0];
  if (!file) {
    alert('Pilih gambar terlebih dahulu.');
    return;
  }
  statusDiv.innerHTML = 'Mengunggah gambar...';

  const formData = new FormData();
  formData.append('file', file);

  fetch('https://fgsi.koyeb.app/api/upload/uploadMtyun', {
    method: 'POST',
    headers: {
      'apikey': 'fgsiapi-1afccfd1-6d'
    },
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.status && data.data && data.data.url) {
      uploadedImageUrl = data.data.url;
      document.getElementById('prompt').value = uploadedImageUrl; // otomatis isi prompt
      statusDiv.innerHTML = 'Gambar berhasil diupload dan URL dimasukkan ke prompt.';
    } else {
      throw new Error('Respon tidak valid dari API upload.');
    }
  })
  .catch(err => {
    statusDiv.innerHTML = 'Gagal upload: ' + err.message;
  });
}

function generate() {
  const prompt = document.getElementById('prompt').value.trim();
  const resultDiv = document.getElementById('result');

  if (!prompt) {
    alert('Isi prompt dulu.');
    return;
  }

  resultDiv.innerHTML = 'Memproses, tunggu sebentar...';

  const apiKey = 'MELvQtx7BG'; // API key
  const url = `https://api.ibeng.my.id/api/ai/veo3?query=${encodeURIComponent(prompt)}&apikey=${apiKey}`;

  fetch(url)
  .then(res => res.json())
  .then(data => {
    resultDiv.innerHTML = '';

    // Tampilkan gambar upload jika ada
    if (uploadedImageUrl) {
      const imgUpload = document.createElement('img');
      imgUpload.src = uploadedImageUrl;
      imgUpload.alt = 'Gambar Upload';
      resultDiv.appendChild(imgUpload);
    }

    // Tampilkan hasil generate
    if (data && data.data && data.data.data) {
      const media = data.data.data;
      if (media.image_url) {
        const img = document.createElement('img');
        img.src = media.image_url;
        img.alt = prompt;
        resultDiv.appendChild(img);
      }
      if (media.video_url) {
        const video = document.createElement('video');
        video.src = media.video_url;
        video.controls = true;
        resultDiv.appendChild(video);
      }
    } else {
      resultDiv.innerHTML += 'Gagal mendapatkan data.';
    }
  })
  .catch(err => {
    resultDiv.innerHTML = 'Error: ' + err.message;
  });
}
</script>

</body>
</html>
