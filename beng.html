<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Veo 3 - AI Video Generation</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #6e48aa;
      --secondary: #9d50bb;
      --accent: #4776e6;
      --bg: #f5f7fb;
      --panel: #ffffff;
      --text: #1f2230;
      --muted: #60657a;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --border: #e4e7ee;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
    }

    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff; padding: 28px 18px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 18px; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; }

    /* Menghapus bagian header API */
    /* .header-section { display: none; } */

    .hero {
      padding: 26px 0 8px;
    }
    .hero h1 { margin: 0 0 8px; font-size: 28px; font-weight: 800; }
    .hero p { margin: 0; opacity: .9; }

    main { padding: 26px 0 60px; }
    .grid {
      display: grid; grid-template-columns: 1.2fr .8fr; gap: 22px;
    }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; box-shadow: 0 8px 20px rgba(31,34,48,.04);
    }
    .card h2 { margin: 0 0 14px; font-size: 18px; }
    .muted { color: var(--muted); font-size: 14px; }

    label { display:block; font-weight: 700; margin: 12px 0 6px; font-size: 14px; }
    textarea, input[type="number"] {
      width: 100%; padding: 12px 12px; border: 1px solid var(--border);
      border-radius: 10px; font-size: 14px; outline: none;
      transition: box-shadow .2s, border-color .2s;
      background: #fff;
    }
    textarea { min-height: 120px; resize: vertical; }
    input:focus, textarea:focus, select:focus { box-shadow: 0 0 0 4px rgba(71,118,230,.12); border-color: var(--accent); }

    .row2 { display:flex; gap: 12px; }
    .row2 > * { flex: 1; }

    .dropzone {
      border: 2px dashed var(--border); border-radius: 12px; padding: 18px;
      display: grid; place-items: center; text-align: center; cursor: pointer; background: #fafbff;
    }
    .dropzone:hover { border-color: var(--accent); background: #f2f5ff; }

    .btn {
      display:inline-flex; align-items:center; gap:8px;
      background: var(--accent); color:#fff; border:none; border-radius:10px;
      padding: 12px 16px; font-weight: 800; cursor:pointer; letter-spacing:.3px;
      box-shadow: 0 6px 18px rgba(71,118,230,.25);
      transition: transform .08s ease, filter .2s;
    }
    .btn.secondary { background: #ffffff; color: var(--accent); border: 1px solid var(--border); box-shadow: none; }
    .btn:active { transform: translateY(1px); }
    .btn:hover { filter: brightness(.95); }

    .actions { display:flex; flex-wrap: wrap; gap:10px; margin-top: 14px; }

    .preview {
      border-radius: 12px; overflow:hidden; background:#0b0b0f; min-height: 180px;
      display:grid; place-items:center;
    }
    video, img { max-width: 100%; border-radius: 8px; }

    .progress {
      margin-top: 12px; height: 12px; width: 100%; background: #eef1f7; border-radius: 999px; overflow: hidden;
    }
    .bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--secondary)); transition: width .4s; }

    .log { margin-top: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; background: #0e1117; color: #d1d5db; border-radius: 10px; padding: 12px; max-height: 220px; overflow:auto; }

    .pill {
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
    }
    .ok { background: rgba(40,167,69,.12); color: var(--success); }
    .bad { background: rgba(220,53,69,.12); color: var(--danger); }
    .warn{ background: rgba(255,193,7,.14); color: #b08900; }
    .hint{ font-size: 12px; color: var(--muted); margin-top: 6px; }

    footer { text-align:center; color: var(--muted); padding: 26px 0 40px; }
    .small { font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <!-- Bagian header API yang dihapus -->
    <div class="container">
      <div class="hero">
        <h1>Create AI videos with Veo3 Prompt</h1>
        <p>Enter prompt to generate video via Veo3 API. Results will be shown below.</p>
      </div>
    </div>
  </header>

  <main>
    <div class="container grid">
      <section class="card">
        <h2>Generation Settings</h2>
        <p class="muted">Enter your prompt and generate the video.</p>

        <label for="prompt">Prompt</label>
        <textarea id="prompt" placeholder="Describe your video..."></textarea>
        <div class="hint">Example: Cinematic 4K pirate ship in a storm, dramatic lighting, 24fps, realistic water, intense atmosphere.</div>

        <div class="row2">
          <div>
            <label for="aspect">Aspect Ratio</label>
            <select id="aspect">
              <option value="16:9">16:9 (Landscape)</option>
              <option value="9:16">9:16 (Portrait)</option>
              <option value="1:1">1:1 (Square)</option>
            </select>
          </div>
          <div>
            <label for="duration">Duration (sec)</label>
            <input id="duration" type="number" min="2" max="60" step="1" value="6"/>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="steps">Steps</label>
            <input id="steps" type="number" min="1" max="100" step="1" value="30"/>
          </div>
          <div>
            <label for="cfg">CFG / Guidance</label>
            <input id="cfg" type="number" min="0" max="20" step="0.5" value="6.5"/>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="seed">Seed (optional)</label>
            <input id="seed" type="text" placeholder="-1 for random" value="-1"/>
          </div>
          <div>
            <label for="fps">FPS</label>
            <input id="fps" type="number" min="4" max="60" step="1" value="24"/>
          </div>
        </div>

        <!-- Tombol untuk panggil API Veo3 -->
        <div style="margin-top:20px;">
          <button class="btn" id="veo3Btn"><i class="fa-solid fa-magic"></i> Get Veo3 Result</button>
        </div>

        <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
        <div id="log" class="log" aria-live="polite"></div>
      </section>

      <aside class="card">
        <h2>Result</h2>
        <div class="preview" id="preview">
          <span class="muted">Your result will appear here</span>
        </div>
        <div class="actions" style="margin-top:12px">
          <a id="download" class="btn" href="#" download="veo3_result.mp4" style="display:none"><i class="fa-solid fa-download"></i> Download</a>
          <button id="copyLink" class="btn secondary" style="display:none"><i class="fa-regular fa-copy"></i> Copy Link</button>
        </div>
        <p class="hint">If your API returns a direct video URL, it will play here. If it returns a job id, the app will poll until ready.</p>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container small">
      <div class="pill warn"><i class="fa-solid fa-triangle-exclamation"></i> Security note</div>
      Store keys only on devices you trust. This is a front-end demo. In production, proxy requests via your own backend.
    </div>
  </footer>

  <script>
    // =================== Fungsi call API Veo3 ===================
    async function callVeo3(query) {
      const apiUrl = "https://api.ibeng.my.id/api/ai/veo3?query=" + encodeURIComponent(query) + "&apikey=MrsNK32zbG";
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("API request failed");
        const result = await response.json();

        if (result.status === "Success" && result.data && result.data.data) {
          const imageUrl = result.data.data.image_url;
          const videoUrl = result.data.data.video_url;
          setPreviewImage(imageUrl);
          setPreviewVideo(videoUrl);
        } else {
          log("API response error: " + (result.message || "Unknown error"));
        }
      } catch (err) {
        log("Error calling Veo3 API: " + err.message);
      }
    }

    function setPreviewImage(url) {
      preview.innerHTML = `<img src="${url}" alt="Generated Image"/>`;
      downloadA.style.display = "none";
      copyLink.style.display = "none";
    }

    function setPreviewVideo(url) {
      preview.innerHTML = `<video controls autoplay playsinline src="${url}"></video>`;
      downloadA.style.display = "inline-flex";
      downloadA.href = url;
      copyLink.style.display = "inline-flex";
      copyLink.onclick = async () => {
        try { await navigator.clipboard.writeText(url); copyLink.innerHTML = '<i class="fa-regular fa-copy"></i> Copied'; setTimeout(()=>{copyLink.innerHTML='<i class="fa-regular fa-copy"></i> Copy Link';},1200);} catch {}
      };
    }

    // =================== Event untuk tombol Veo3 Result ===================
    document.getElementById("veo3Btn").addEventListener("click", () => {
      const promptText = document.getElementById("prompt").value.trim();
      if (promptText) {
        callVeo3(promptText);
      } else {
        alert("Please enter a prompt");
      }
    });

    // =================== Sisa kode untuk generate ===================
    const promptEl = document.getElementById("prompt");
    const aspectEl = document.getElementById("aspect");
    const durationEl = document.getElementById("duration");
    const stepsEl = document.getElementById("steps");
    const cfgEl = document.getElementById("cfg");
    const seedEl = document.getElementById("seed");
    const fpsEl = document.getElementById("fps");
    const logEl = document.getElementById("log");
    const barEl = document.getElementById("bar");
    const preview = document.getElementById("preview");
    const downloadA = document.getElementById("download");
    const copyLink = document.getElementById("copyLink");

    let abortCtrl = null;
    let currentJob = null;

    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.textContent += `[${time}] ${msg}\n`;
    }
    function setProgress(p) {
      const pct = Math.max(0, Math.min(100, Math.round(p * 100)));
      barEl.style.width = pct + "%";
    }

    function requireConf() {
      const base = ""; // kosong karena tidak pakai
      const key  = ""; // kosong karena tidak pakai
      if (!base || !key) { return null; }
      return { base, key };
    }

    // Generate video
    async function startGeneration() {
      const prompt = promptEl.value.trim();
      if (!prompt) { alert("Please enter a prompt"); return; }

      const conf = { base: "", key: "" }; // tidak pakai auth
      const fd = new FormData();
      fd.append("prompt", prompt);
      fd.append("aspect", aspectEl.value);
      fd.append("duration", String(durationEl.value));
      fd.append("steps", String(stepsEl.value));
      fd.append("cfg", String(cfgEl.value));
      if (seedEl.value.trim()) fd.append("seed", seedEl.value.trim());
      fd.append("fps", String(fpsEl.value));

      abortCtrl = new AbortController();
      setProgress(0);
      log("Submitting job...");
      // Jika ingin pakai API auth, tambahkan headers dan conf
      try {
        const res = await fetch("https://api.ibeng.my.id/api/ai/veo3/generate", {
          method: "POST",
          // headers: { "Authorization": "Bearer ..." },
          body: fd,
          signal: abortCtrl.signal
        });
        if (!res.ok) throw new Error("Request failed");
        const data = await res.json();
        log("Response: " + JSON.stringify(data));

        if (data.video_url) {
          setProgress(1);
          setPreviewVideo(data.video_url);
        } else if (data.job_id) {
          currentJob = data.job_id;
          log("Job ID: " + currentJob);
          await pollJob(currentJob);
        } else {
          throw new Error("Unexpected response");
        }
      } catch (err) {
        log("Error: " + err.message);
      }
    }

    async function pollJob(jobId) {
      let done = false;
      let tries = 0;
      while (!done && tries < 600) {
        await new Promise(r => setTimeout(r, 1000));
        tries++;
        try {
          const r = await fetch(`https://api.ibeng.my.id/api/ai/veo3/jobs/${encodeURIComponent(jobId)}`);
          if (!r.ok) throw new Error("Status " + r.status);
          const j = await r.json();
          if (typeof j.progress === "number") setProgress(j.progress);
          if (j.status) log("Status: " + j.status + (j.progress != null ? ` (${Math.round(j.progress * 100)}%)` : ""));
          if (j.status === "succeeded" && j.video_url) {
            setProgress(1);
            setPreviewVideo(j.video_url);
            log("Job succeeded");
            done = true;
            break;
          }
          if (j.status === "failed") {
            throw new Error(j.error || "Job failed");
          }
        } catch (e) {
          log("Polling error: " + e.message);
        }
        if (abortCtrl == null) { log("Polling stopped."); break; }
      }
    }

    document.getElementById("generate").addEventListener("click", startGeneration);
    document.getElementById("cancel").addEventListener("click", () => {
      if (abortCtrl) abortCtrl.abort(), abortCtrl = null;
    });
  </script>
</body>
</html>
