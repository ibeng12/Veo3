<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Veo 3 - AI Video Generation (Your API Key)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #6e48aa;
      --secondary: #9d50bb;
      --accent: #4776e6;
      --bg: #f5f7fb;
      --panel: #ffffff;
      --text: #1f2230;
      --muted: #60657a;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --border: #e4e7ee;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
    }
    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff; padding: 28px 18px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 18px; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; }

    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: .3px; }
    .brand i { color: var(--accent); font-size: 22px; }
    .brand span { font-size: 20px; }

    .keybar {
      display: flex; gap: 10px; flex-wrap: wrap;
      background: rgba(255,255,255,.12);
      padding: 10px; border-radius: 10px;
    }
    .keybar input, .keybar button {
      border: none; border-radius: 8px; padding: 10px 12px; font-size: 14px;
    }
    .keybar input {
      min-width: 220px; color: #1a1a2e;
    }
    .keybar .api, .keybar .baseurl {
      background: #fff; outline: none;
    }
    .keybar button {
      background: #fff; color: var(--primary); font-weight: 700; cursor: pointer;
    }
    .keybar button:hover { filter: brightness(.95); }
    .tag {
      padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,.18);
      font-size: 12px; display: inline-flex; align-items: center; gap: 6px;
    }
    .tag i { font-size: 12px; }

    .hero {
      padding: 26px 0 8px;
      color: #fff;
    }
    .hero h1 { margin: 0 0 8px; font-size: 28px; font-weight: 800; }
    .hero p { margin: 0; opacity: .9; }

    main { padding: 26px 0 60px; }
    .grid {
      display: grid; grid-template-columns: 1.2fr .8fr; gap: 22px;
    }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; box-shadow: 0 8px 20px rgba(31,34,48,.04);
    }
    .card h2 { margin: 0 0 14px; font-size: 18px; }
    .muted { color: var(--muted); font-size: 14px; }

    label { display:block; font-weight: 700; margin: 12px 0 6px; font-size: 14px; }
    input[type="text"], input[type="number"], textarea, select {
      width: 100%; padding: 12px 12px; border: 1px solid var(--border);
      border-radius: 10px; font-size: 14px; outline: none;
      transition: box-shadow .2s, border-color .2s;
      background: #fff;
    }
    textarea { min-height: 120px; resize: vertical; }
    input:focus, textarea:focus, select:focus { box-shadow: 0 0 0 4px rgba(71,118,230,.12); border-color: var(--accent); }

    .row2 { display:flex; gap: 12px; }
    .row2 > * { flex: 1; }

    .dropzone {
      border: 2px dashed var(--border); border-radius: 12px; padding: 18px;
      display: grid; place-items: center; text-align: center; cursor: pointer; background: #fafbff;
    }
    .dropzone:hover { border-color: var(--accent); background: #f2f5ff; }

    .btn {
      display:inline-flex; align-items:center; gap:8px;
      background: var(--accent); color:#fff; border:none; border-radius:10px;
      padding: 12px 16px; font-weight: 800; cursor:pointer; letter-spacing:.3px;
      box-shadow: 0 6px 18px rgba(71,118,230,.25);
      transition: transform .08s ease, filter .2s;
    }
    .btn.secondary { background: #ffffff; color: var(--accent); border: 1px solid var(--border); box-shadow: none; }
    .btn:active { transform: translateY(1px); }
    .btn:hover { filter: brightness(.95); }

    .actions { display:flex; flex-wrap: wrap; gap:10px; margin-top: 14px; }

    .preview {
      border-radius: 12px; overflow:hidden; background:#0b0b0f; min-height: 180px;
      display:grid; place-items:center;
    }
    video, img { max-width: 100%; border-radius: 8px; }

    .progress {
      margin-top: 12px; height: 12px; width: 100%; background: #eef1f7; border-radius: 999px; overflow: hidden;
    }
    .bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--secondary)); transition: width .4s; }

    .log { margin-top: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; background: #0e1117; color: #d1d5db; border-radius: 10px; padding: 12px; max-height: 220px; overflow:auto; }

    .pill {
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
    }
    .ok { background: rgba(40,167,69,.12); color: var(--success); }
    .bad { background: rgba(220,53,69,.12); color: var(--danger); }
    .warn{ background: rgba(255,193,7,.14); color: #b08900; }
    .hint{ font-size: 12px; color: var(--muted); margin-top: 6px; }

    footer { text-align:center; color: var(--muted); padding: 26px 0 40px; }
    .small { font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="row">
        <div class="brand"><i class="fa-solid fa-clapperboard"></i><span>Veo 3 Generator</span></div>
        <div class="keybar">
          <input id="baseUrl" class="baseurl" type="text" placeholder="API Base URL (e.g. https://api.ibeng.my.id)" />
          <input id="apiKey" class="api" type="text" placeholder="Your API Key (Bearer)" />
          <button id="saveKey"><i class="fa-solid fa-key"></i> Save</button>
          <div id="keyStatus" class="tag"><i class="fa-regular fa-circle"></i> Not set</div>
        </div>
      </div>
      <div class="hero">
        <h1>Create AI videos with your own API key</h1>
        <p>Prompt-to-video and image-conditioned generation. Keys are stored locally in your browser (localStorage).</p>
      </div>
    </div>
  </header>

  <main>
    <div class="container grid">
      <section class="card">
        <h2>Generation Settings</h2>
        <p class="muted">Fill in your prompt. Adjust parameters as needed.</p>

        <label for="prompt">Prompt</label>
        <textarea id="prompt" placeholder="Describe your video..."></textarea>
        <div class="hint">Example: Cinematic 4K pirate ship in a storm, dramatic lighting, 24fps, realistic water, intense atmosphere.</div>

        <div class="row2">
          <div>
            <label for="aspect">Aspect Ratio</label>
            <select id="aspect">
              <option value="16:9">16:9 (Landscape)</option>
              <option value="9:16">9:16 (Portrait)</option>
              <option value="1:1">1:1 (Square)</option>
            </select>
          </div>
          <div>
            <label for="duration">Duration (sec)</label>
            <input id="duration" type="number" min="2" max="60" step="1" value="6"/>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="steps">Steps</label>
            <input id="steps" type="number" min="1" max="100" step="1" value="30"/>
          </div>
          <div>
            <label for="cfg">CFG / Guidance</label>
            <input id="cfg" type="number" min="0" max="20" step="0.5" value="6.5"/>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="seed">Seed (optional)</label>
            <input id="seed" type="text" placeholder="-1 for random" value="-1"/>
          </div>
          <div>
            <label for="fps">FPS</label>
            <input id="fps" type="number" min="4" max="60" step="1" value="24"/>
          </div>
        </div>

        <!-- Reference Image upload dihapus sesuai permintaan -->

        <div class="actions">
          <button class="btn" id="generate"><i class="fa-solid fa-wand-magic-sparkles"></i> Generate</button>
          <button class="btn secondary" id="cancel"><i class="fa-solid fa-stop"></i> Cancel</button>
        </div>

        <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
        <div id="log" class="log" aria-live="polite"></div>
      </section>

      <aside class="card">
        <h2>Result</h2>
        <div class="preview" id="preview">
          <span class="muted">Your result will appear here</span>
        </div>
        <div class="actions" style="margin-top:12px">
          <a id="download" class="btn" href="#" download="veo3_result.mp4" style="display:none"><i class="fa-solid fa-download"></i> Download</a>
          <button id="copyLink" class="btn secondary" style="display:none"><i class="fa-regular fa-copy"></i> Copy Link</button>
        </div>
        <p class="hint">If your API returns a direct video URL, it will play here. If it returns a job id, the app will poll until ready.</p>

        <h3 style="margin-top:18px">Connection</h3>
        <div id="conn" class="small muted">Base URL: <span id="connBase">—</span><br/>Auth: Bearer &lt;your-key&gt;</div>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container small">
      <div class="pill warn"><i class="fa-solid fa-triangle-exclamation"></i> Security note</div>
      Store keys only on devices you trust. This is a pure front‑end demo. In production, proxy requests via your own backend to keep keys private and enable CORS.
    </div>
  </footer>

  <script>
    // ======= Config =======
    // API endpoint: https://api.ibeng.my.id/api/ai/veo3?query=&apikey=YOUR_API_KEY
    // Expect POST request to /api/ai/veo3 with JSON body, response contains image_url and video_url

    // Variabel tanpa LS_KEY dan LS_BASE
    const baseUrlInput = document.getElementById("baseUrl");
    const apiKeyInput  = document.getElementById("apiKey");
    const saveKeyBtn= document.getElementById("saveKey");
    const keyStatus = document.getElementById("keyStatus");
    const connBase  = document.getElementById("connBase");

    const promptEl  = document.getElementById("prompt");
    const aspectEl  = document.getElementById("aspect");
    const durationEl= document.getElementById("duration");
    const stepsEl   = document.getElementById("steps");
    const cfgEl     = document.getElementById("cfg");
    const seedEl    = document.getElementById("seed");
    const fpsEl     = document.getElementById("fps");

    const genBtn    = document.getElementById("generate");
    const cancelBtn = document.getElementById("cancel");
    const logEl     = document.getElementById("log");
    const barEl     = document.getElementById("bar");

    const preview   = document.getElementById("preview");
    const downloadA = document.getElementById("download");
    const copyLink  = document.getElementById("copyLink");

    let abortCtrl = null;
    let currentJob = null;

    // Load saved API key dan URL dari localStorage
    function loadSaved() {
      // Tidak menggunakan LS_KEY dan LS_BASE, jadi bisa diisi manual
      const savedKey = localStorage.getItem("VEO3_API_KEY") || "";
      const savedBase= localStorage.getItem("VEO3_BASE_URL") || "";
      apiKeyInput.value = savedKey;
      baseUrlInput.value= savedBase;
      updateKeyStatus();
      connBase.textContent = savedBase || "—";
    }

    function updateKeyStatus() {
      const has = !!apiKeyInput.value.trim();
      keyStatus.innerHTML = has
        ? '<i class="fa-regular fa-circle-check"></i> Key set'
        : '<i class="fa-regular fa-circle"></i> Not set';
      keyStatus.className = "tag " + (has ? "ok" : "");
    }

    saveKeyBtn.addEventListener("click", () => {
      localStorage.setItem("VEO3_API_KEY", apiKeyInput.value.trim());
      localStorage.setItem("VEO3_BASE_URL", baseUrlInput.value.trim());
      updateKeyStatus();
      connBase.textContent = baseUrlInput.value.trim() || "—";
      log("Saved API key and Base URL.");
    });

    // ======= Helper functions =======
    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.textContent += `[${time}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }
    function setProgress(p) {
      const pct = Math.max(0, Math.min(100, Math.round(p * 100)));
      barEl.style.width = pct + "%";
    }
    function setPreviewVideo(url) {
      preview.innerHTML = `<video id="vid" controls playsinline></video>`;
      const vid = document.getElementById("vid");
      vid.src = url;
      vid.load();
      downloadA.style.display = "inline-flex";
      downloadA.href = url;
      copyLink.style.display = "inline-flex";
      copyLink.onclick = async () => {
        try { await navigator.clipboard.writeText(url); copyLink.innerHTML = '<i class="fa-regular fa-copy"></i> Copied'; setTimeout(()=>copyLink.innerHTML='<i class="fa-regular fa-copy"></i> Copy Link',1200);} catch {}
      };
    }

    function requireConf() {
      const base = baseUrlInput.value.trim();
      const key  = apiKeyInput.value.trim();
      if (!base) { alert("Please set API Base URL"); return null; }
      if (!key ) { alert("Please set API Key"); return null; }
      return { base, key };
    }

    // ======= Generate process =======
    async function startGeneration() {
      const conf = requireConf(); if (!conf) return;
      const prompt = promptEl.value.trim();
      if (!prompt) { alert("Please enter a prompt"); return; }

      // Membuat payload JSON sesuai API
      const payload = {
        query: prompt,
        apikey: conf.key,
        aspect: aspectEl.value,
        duration: parseInt(durationEl.value),
        steps: parseInt(stepsEl.value),
        cfg: parseFloat(cfgEl.value),
        seed: seedEl.value.trim() || "-1",
        fps: parseInt(fpsEl.value)
      };

      abortCtrl = new AbortController();
      setProgress(0);
      log("Submitting generation job...");
      genBtn.disabled = true;

      try {
        const res = await fetch(conf.base.replace(/\/+$/,"") + "/api/ai/veo3?query=" + encodeURIComponent(payload.query) + "&apikey=" + encodeURIComponent(payload.apikey), {
          method: "GET", // API Anda menggunakan GET, sesuai data yang diberikan
        });
        if (!res.ok) throw new Error("Request failed: " + res.status + " " + res.statusText);
        const data = await res.json();
        log("Response: " + JSON.stringify(data));

        if (data.data && data.data.video_url) {
          setProgress(1);
          log("Received direct video URL.");
          setPreviewVideo(data.data.video_url);
        } else {
          throw new Error("Unexpected response. No video URL found.");
        }
      } catch (err) {
        if (err.name === "AbortError") {
          log("Generation cancelled by user.");
        } else {
          console.error(err);
          log("Error: " + err.message);
          alert("Generation error: " + err.message);
        }
      } finally {
        genBtn.disabled = false;
        abortCtrl = null;
      }
    }

    // Event listener tombol generate
    genBtn.addEventListener("click", startGeneration);
    cancelBtn.addEventListener("click", () => {
      if (abortCtrl) { abortCtrl.abort(); abortCtrl = null; }
    });

    // Load konfigurasi sebelumnya
    loadSaved();
  </script>
</body>
</html>
